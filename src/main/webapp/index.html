<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>超级无敌开口中中中中</title>
<link href="https://unpkg.com/video.js/dist/video-js.min.css" rel="stylesheet">
<script src="https://unpkg.com/video.js/dist/video.min.js"></script>
<script type='text/javascript'
      src='/WebSpeech/WebSpeech.js'></script>
<style>
.tableStyle{
    width: 100%;
    height: 100px;
    text-align: center;
}

.numberStyle {
    border-style: solid;
    border-width: thick;
    font-size: 210px;
    margin-top: 0px;
}

.bingoNumberStyle {
    border-style: solid;
    border-width: thick;
    font-size: 210px;
    margin-top: 0px;
    border-color: yellow;
}

.bingoStyle{
    background-image: url("/img/crown.jpeg");
    background-repeat: no-repeat;
    background-size: 105px;
    height: 70px;
}

.notBingoStyle{
    background-repeat: no-repeat;
    background-size: 105px;
    height: 70px;
}
</style>
</head>
<body>

	<div>
		<table class="tableStyle">
			<tr>
				<td style="width:35%">
					<p id="beginBingo" class="notBingoStyle"></p>
					<p id="begin" class="numberStyle"></p>
					</td>
				<td style="width:30%" />
				<td style="width:35%">
					<p id="endBingo" class="notBingoStyle"></p>
					<p id="end" class="numberStyle" ></p></td>
			</tr>
		</table>

		<table>
			<tr>
				<td>speakNum:<input id="speakNum" value="" /></td>
				<td><input onClick="enter();return false;" value="enter" type="button" /></td>
			</tr>
		</table>
	</div>
	<div style="display:none">
		<video
	    id="my-player"
	    class="video-js"
	    controls
	    preload="auto"
	    data-setup='{}'>
	   <source src="/mp4/bingo.mp3" type="video/mp4"></source>
	  <p class="vjs-no-js">
	    To view this video please enable JavaScript, and consider upgrading to a
	    web browser that
	    <a href="http://videojs.com/html5-video-support/" target="_blank">
	      supports HTML5 video
	    </a>
	  </p>
	</video>
	</div>

<script type='text/javascript'>

WebSpeech.ready(function() {
    WebSpeech.server = 'http://120.24.87.124/cgi-bin/ekho2.pl';
    WebSpeech.setVoice('EkhoCantonese');
  });
  
 
var end = 100;
var begin = 1;
var answer = Math.floor(Math.random() * (end - begin) + begin);
console.log("answer:" + answer);
updateBegin(begin);
updateEnd(end);
refreshCurrentRange();

function updateBegin(newBegin){
	begin = newBegin;
}

function updateEnd(newEnd){
	end = newEnd;
}

function refreshCurrentRange(){
	document.getElementById("begin").innerHTML = begin;
	document.getElementById("end").innerHTML = end;
}

function speakCurrentRange(){
		WebSpeech.speak(begin + "");
		WebSpeech.onfinish = function () { 
			WebSpeech.speak("至");
			WebSpeech.onfinish = function () { 
				WebSpeech.speak(end + "");
				WebSpeech.onfinish = function () {
					refreshCurrentRange();
					WebSpeech.onfinish = function (){};
				};
			};
		};
}

function displayBingoStyle(){
	var effectOn = false;
	setInterval(function(){
		if(effectOn){
			document.getElementById("beginBingo").className="notBingoStyle";
			document.getElementById("endBingo").className="notBingoStyle";
			document.getElementById("begin").className="numberStyle";
			document.getElementById("end").className="numberStyle";
			effectOn = false;
		}else{
			document.getElementById("beginBingo").className="bingoStyle";
			document.getElementById("endBingo").className="bingoStyle";
			document.getElementById("begin").className="bingoNumberStyle";
			document.getElementById("end").className="bingoNumberStyle";
			effectOn = true;
		}
	}, 1000);
	
}

function enter(){
	var speakNum = parseInt(document.getElementById("speakNum").value.trim(), 10);
	setTimeout(function(){
		if(speakNum == answer){ // answer hit
			updateBegin(speakNum);
			updateEnd(speakNum);
			refreshCurrentRange();
			var player = videojs('my-player');
			setTimeout(function(){
				displayBingoStyle();
				player.play();
			}, 500);
		}else{										// update range
			if(speakNum > answer && speakNum < end){
				updateEnd(speakNum);
				speakCurrentRange();
			}else if(speakNum < answer && speakNum > begin){
				updateBegin(speakNum);
				speakCurrentRange();
			}else{
				WebSpeech.speak("数字必须在范围内");
			}
		}
		document.getElementById("speakNum").value = "";
	}, 1000);
	
}
</script>
</body>
</html>